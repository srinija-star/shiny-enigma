
name: ZAP Baseline Scan

on:
  push:
    branches: [ main ]
  pull_request:

# ✅ Add permissions here — at the ROOT level, same indentation as “on” and “jobs”
permissions:
  contents: read     # allows workflow to read repo files
  packages: read     # REQUIRED to pull GHCR images (fixes "denied" error)

jobs:
  zap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Authenticate to GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Run ZAP Baseline Scan
        uses: zaproxy/action-baseline@v0.15.0
        with:
          target: 'http://testphp.vulnweb.com/'
          cmd_options: '-a'
